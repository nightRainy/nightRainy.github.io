

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fox.jpg">
  <link rel="icon" href="/img/fox.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="知世">
  <meta name="keywords" content="">
  
    <meta name="description" content="华庭师傅的glibc内存管理简直逆天,这里写一下笔记,更新中  内存经典布局这里随便画一下QAQ 32位| Kernel| &lt;- 0xc00000000&#x3D;&#x3D;TASK_SIZE|——-| |       | &lt;- Random stack offset|——-|    stack       ——-   Memory Mapping region      ——-">
<meta property="og:type" content="article">
<meta property="og:title" content="glic内存管理学习笔记">
<meta property="og:url" content="https://nightrainy.github.io/2019/05/06/glic%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="知世の小屋">
<meta property="og:description" content="华庭师傅的glibc内存管理简直逆天,这里写一下笔记,更新中  内存经典布局这里随便画一下QAQ 32位| Kernel| &lt;- 0xc00000000&#x3D;&#x3D;TASK_SIZE|——-| |       | &lt;- Random stack offset|——-|    stack       ——-   Memory Mapping region      ——-">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-05-06T15:17:25.000Z">
<meta property="article:modified_time" content="2019-05-07T07:16:34.000Z">
<meta property="article:author" content="知世">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>glic内存管理学习笔记 - 知世の小屋</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"nightrainy.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>知世</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/rick.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="glic内存管理学习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-05-06 23:17" pubdate>
          2019年5月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          73 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">glic内存管理学习笔记</h1>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>华庭师傅的glibc内存管理简直逆天,这里写一下笔记,更新中</p>
</blockquote>
<h1 id="内存经典布局"><a href="#内存经典布局" class="headerlink" title="内存经典布局"></a>内存经典布局</h1><p>这里随便画一下QAQ</p>
<h2 id="32位"><a href="#32位" class="headerlink" title="32位"></a>32位</h2><p>| Kernel| &lt;- 0xc00000000&#x3D;&#x3D;TASK_SIZE<br>|——-|</p>
<p>|       | &lt;- Random stack offset<br>|——-|</p>
<table>
<thead>
<tr>
<th>stack</th>
</tr>
</thead>
<tbody><tr>
<td></td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Memory Mapping region</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>heap</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>BSS segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Data segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Text segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td></td>
</tr>
</tbody></table>
<h2 id="64位"><a href="#64位" class="headerlink" title="64位"></a>64位</h2><p>| Kernel| &lt;- 0xFFFF800000000000<br>|——-|</p>
<p>| undefine region      | &lt;- 0X00007FFFFFFFF000&#x3D;TASK_SIZE<br>|——-|</p>
<table>
<thead>
<tr>
<th>stack</th>
</tr>
</thead>
<tbody><tr>
<td></td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Memory Mapping region</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>heap</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>BSS segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Data segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td>Text segment</td>
</tr>
<tr>
<td>——-</td>
</tr>
<tr>
<td></td>
</tr>
</tbody></table>
<h1 id="内容设计假设"><a href="#内容设计假设" class="headerlink" title="内容设计假设"></a>内容设计假设</h1><h2 id="6个假设"><a href="#6个假设" class="headerlink" title="6个假设"></a>6个假设</h2><ul>
<li>对长生命周期的大内存分配使用mmap</li>
<li>特别大的内存分配总使用mmap</li>
<li>具有短生命周期的内存分配使用brk</li>
<li>尽量只缓存临时使用的空闲小内存块</li>
<li>空闲小内存块只会在malloc和free时合并,free时空闲内存块可能放入pool中,不一定归还给操作系统</li>
<li>收缩堆的条件<ul>
<li>当前free块大小加上前后可合并chunk大于64kb</li>
<li>堆顶大小达到阈值</li>
<li>这样会把堆最顶端空闲内存返回给操作系统</li>
</ul>
</li>
</ul>
<h2 id="记忆问题"><a href="#记忆问题" class="headerlink" title="记忆问题"></a>记忆问题</h2><ul>
<li>收缩堆的条件有?</li>
<li>结果是?</li>
<li>都有哪些假设?</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>大内存,长周期 -&gt; mmap</li>
<li>短周期 -&gt; brk</li>
<li>缓存的内存块尽可能时大小较小的</li>
<li>空闲块只有在分配和free的时候会合并</li>
<li>free的时候不一定归还给操作系统(会成为cache)</li>
<li>空闲chunk大小 &gt; 64KB 时合并chunk -&gt;收缩堆</li>
<li>堆顶大小达到阈值 -&gt; 收缩堆</li>
<li>收缩堆会将堆最顶端空间内存返回给操作系统</li>
</ul>
<h1 id="数据结构概述"><a href="#数据结构概述" class="headerlink" title="数据结构概述"></a>数据结构概述</h1><h2 id="Main-arena-与-non-main-arena"><a href="#Main-arena-与-non-main-arena" class="headerlink" title="Main_arena 与 non_main_arena"></a>Main_arena 与 non_main_arena</h2><h3 id="原文概述"><a href="#原文概述" class="headerlink" title="原文概述"></a>原文概述</h3><ul>
<li>在 Doug Lea 实现的内存分配器中只有一个主分配区（main arena）</li>
<li>每次分配内存都必须对主分配区加锁，分配完成后释放锁</li>
<li>在 SMP 多线程环境下，对主分配区的锁的争用很激烈，严重影响了malloc 的分配效率。于是Wolfram Gloger 在 Doug Lea 的基础上改进使得 Glibc 的malloc 可以支持多线程，增加了非主分配区（non main arena）支持</li>
<li>主分配区与非主分配区用环形链表进行管理。每一个分配区利用互斥锁（mutex）使线程对于该分配区的访问互斥。 </li>
<li>每个进程只有一个主分配区，但可能存在多个非主分配区</li>
<li>ptmalloc 根据系统对分配区的争用情况动态增加非主分配区的数量，分配区的数量一旦增加，就不会再减少了。</li>
<li>主分配 区可以访问进程的heap区域和mmap映射区域</li>
<li>主分配区可以使用 sbrk 和mmap 向操作系统申请虚拟内存。而非主分配区只能访问进程的 mmap 映射区域</li>
<li>非主分配区每次使用mmap()向操作系统“批发”HEAP_MAX_SIZE（32 位系统上默认为 1MB，64 位系统默 认为 64MB）大小的虚拟内存</li>
<li>当用户向非主分配区请求分配内存时再切割成小块“零售” 出去</li>
<li>ptmalloc 在必要的情况下才会调用mmap()函数向操作系统申请虚拟内存。 </li>
<li>主分配区可以访问 heap 区域，如果用户不调用 brk()或是 sbrk()函数，分配程序就可以保证分配到连续的虚拟地址空间，因为每个进程只有一个主分配区使用 sbrk()分配 heap 区域的虚拟内存。</li>
<li>内核对 brk 的实现可以看着是mmap 的一个精简版，相对高效一些。</li>
<li>如果主 分配区的内存是通过mmap()向系统分配的，当free该内存时，主分配区会直接调用munmap() 将该内存归还给系统。 </li>
<li>当某一线程需要调用malloc()分配内存空间时，该线程先查看线程私有变量中是否已经存在一个分配区，如果存在，尝试对该分配区加锁，如果加锁成功，使用该分配区分配内存， 如果失败，该线程搜索循环链表试图获得一个没有加锁的分配区。如果所有的分配区都已经 加锁那么malloc()会开辟一个新的分配区，把该分配区加入到全局分配区循环链表并加锁， 然后使用该分配区进行分配内存操作。在释放操作中，线程同样试图获得待释放内存块所在 分配区的锁，如果该分配区正在被别的线程使用，则需要等待直到其他线程释放该分配区的 互斥锁之后才可以进行释放操作。 </li>
<li>申请小块内存时会产生很多内存碎片，ptmalloc 在整理时也需要对分配区做加锁操作。</li>
<li>每个加锁操作大概需要 5～10 个 cpu 指令，而且程序线程很多的情况下，锁等待的时间就会 延长，导致malloc性能下降。一次加锁操作需要消耗100ns左右，正是锁的缘故，导致ptmalloc 在多线程竞争情况下性能远远落后于 tcmalloc。最新版的 ptmalloc 对锁进行了优化，加入了 PER_THREAD和 ATOMIC_FASTBINS 优化，但默认编译不会启用该优化，这两个对锁的优化应 该能够提升多线程内存的分配的效率。</li>
</ul>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>该结构有什么特点?</li>
<li>主分配区和非主分配区的区别是什么?</li>
<li>两者不同的分配方式分别时如何分配的?</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul>
<li>main_arena(MA)为主分配区;non_main_arena(N_MA)为非主分配区</li>
<li>两者通过环形链表进行管理,每个分区采用互斥锁使线程的访问互斥</li>
<li>每个分配区有一个MA,可能有多个N_MA;</li>
<li>N_MA数里只加不减</li>
<li>MA可访问进程的heap和mmap映射区域<ul>
<li>MA可以使用Sbrk和mmap来向系统申请内存</li>
<li>N_MA只能访问进程的MMAP映射区域</li>
</ul>
</li>
<li>主分配区可访问heap区域,若用户不调用brk()&#x2F;sbrk(),将可分配到连续的虚拟内存地址</li>
<li>malloc时先看线程是否有分配区,存在则先加锁,成功则分配内存,否则开辟新分配区,加入环形链表并加锁</li>
</ul>
<h2 id="chunk的组织"><a href="#chunk的组织" class="headerlink" title="chunk的组织"></a>chunk的组织</h2><blockquote>
<p>不管内存是在哪里被分配的，用什么方法分配，用户请求分配的空间在 ptmalloc 中都使用一个 chunk 来表示。用户调用 free()函数释放掉的内存也并不是立即就归还给操作系统， 相反，它们也会被表示为一个chunk，ptmalloc使用特定的数据结构来管理这些空闲的chunk</p>
</blockquote>
<h3 id="chunk格式"><a href="#chunk格式" class="headerlink" title="chunk格式"></a>chunk格式</h3><h4 id="使用中的chunk"><a href="#使用中的chunk" class="headerlink" title="使用中的chunk"></a>使用中的chunk</h4><p>|Size of pre chunk| &lt;-chunk<br>|——-|<br>|Size of chunk,in bytes A&#x2F;M&#x2F;P|<br>|——-|  &lt;-mem<br>|user data|<br>|——-| &lt;- next chunk<br>|Size of chunk,in bytes|</p>
<ul>
<li>在图中，chunk指针指向一个chunk的开始，一个chunk中包含了用户请求的内存区域和相关的控制信息。</li>
<li>图中的mem指针才是真正返回给用户的内存指针。</li>
<li>chunk的第二个域的最低一位为P，它表示前一个块是否在使用中，P为0则表示前一个chunk为空闲，这时 chunk的第一个域prev_size才有效</li>
<li>prev_size表示前一个chunk的size，程序可以使用这个值来找到前一个chunk的开始地址。当P为1时，表示前一个chunk正在使用中，prev_size无效，程序也就不可以得到前一个chunk的大小。不能对前一个chunk进行任何操作。ptmalloc分配的第一个块总是将P设为1，以防止程序引用到不存在的区域。</li>
<li>Chunk的第二个域的倒数第二个位为M，他表示当前chunk是从哪个内存区域获得的虚拟内存。M为1表示该chunk是从mmap映射区域分配的，否则是从heap区域分配的。</li>
<li>Chunk的第二个域倒数第三个位为A，表示该chunk属于主分配区或者非主分配区，如果属于非主分配区，将该位置为1，否则置为0。</li>
</ul>
<h4 id="空闲的chunk"><a href="#空闲的chunk" class="headerlink" title="空闲的chunk"></a>空闲的chunk</h4><p>|Size of pre chunk| &lt;-chunk<br>|——-|<br>|Size of chunk,in bytes A&#x2F; &#x2F;P|<br>|——-|  &lt;-mem<br>| *fd   |<br>| *bk   |<br>|*fd_next size|<br>|*bk_next size|<br>|user data|<br>|——-| &lt;- next chunk<br>|Size of chunk,in bytes|</p>
<ul>
<li>当chunk空闲时，其M状态不存在，只有AP状态，</li>
<li>原本是用户数据区的地方存储了四个指针，指针fd指向后一个空闲的chunk，而bk指向前一个空闲的chunk，ptmalloc通过这两个指针将大小相近的chunk连成一个双向链表。</li>
<li>对于large bin中的空闲chunk，还有两个指针，fd_nextsize和bk_nextsize，这两个指针用于加快在large bin中查找最近匹配的空闲chunk。不同的chunk链表又是通过bins或者fastbins来组织的</li>
</ul>
<h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><ul>
<li>使用中的chunk和空闲时有什么不同?</li>
<li>chunk的第二个域倒数几位都各自代表了什么?</li>
<li>两者各自域都代表了什么?</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><h4 id="chunk-in-use"><a href="#chunk-in-use" class="headerlink" title="chunk in use"></a>chunk in use</h4><ul>
<li>chunk指针指向chunk的开始,但是mem指针才是返回给用户的内存指针</li>
<li>chunk第二个域的倒数三位代表<ul>
<li>A -&gt; 是不是主分配区 . <ul>
<li>0-&gt; MA ;</li>
<li>1-&gt; N_MA;</li>
</ul>
</li>
<li>M -&gt; 是不是由mmap分配的<ul>
<li>0-&gt; heap </li>
<li>1-&gt; mmap;</li>
</ul>
</li>
<li>P -&gt; 前一个chunk是否在使用中  <ul>
<li>0-&gt; 空闲 此时prev_size有效</li>
<li>1-&gt; 使用中, 此时禁止对前一个chunk有任何操作,无法得到其大小</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="free-chunk"><a href="#free-chunk" class="headerlink" title="free chunk"></a>free chunk</h4><ul>
<li>chunk空闲时,M态不存在,只有AP状态</li>
<li>此时用户区存储了四个指针<ul>
<li>fd :指向后一个空闲的chunk</li>
<li>bk :指向前一个空闲的chunk</li>
<li>fd_nextsize :只有在large bin中才使用,因为相同大小的chunk可能有很多,因此为了方便查找,会指向后一个比他小的chunk</li>
<li>bk_nextsize :上同,但是会指向前一个比他小的chunk</li>
</ul>
</li>
</ul>
<h2 id="chunk的空间复用"><a href="#chunk的空间复用" class="headerlink" title="chunk的空间复用"></a>chunk的空间复用</h2><h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><ul>
<li>为了使得 chunk 所占用的空间最小，ptmalloc使用了空间复用</li>
<li>一个 chunk或者正在被使用，或者已经被free掉，所以chunk的中的一些域可以在使用状态和空闲状态表示不同的意义，来达到空间复用的效果。</li>
<li>以32位系统为例，<ul>
<li>空闲时，一个chunk中至少需要4个size_t（4B）大小的空间，用来存储prev_size，size，fd和bk （见上图），也就是16B，chunk的大小要对齐到8B。</li>
<li>当一个chunk处于使用状态时，它的下一个chunk的prev_size域肯定是无效的。所以实际上，这个空间也可以被当前chunk使用</li>
<li>故而实际上，一个使用中的chunk的大小的计算公式应该是：in_use_size &#x3D; (用户请求大小+ 8 - 4 ) align to 8B，这里加8是因为需要存储prev_size和size，但又因为向下一个chunk“借”了4B，所以要减去4。</li>
<li>最后，因为空闲的chunk 和使用中的chunk使用的是同一块空间。所以肯定要取其中最大者作为实际的分配空间。即最终的分配空间chunk_size &#x3D; max(in_use_size, 16)。</li>
<li>这就是当用户请求内存分配时，ptmalloc 实际需要分配的内存大小，在后面的介绍中。如果不是特别指明的地方，指的都是这个经过转换的实际需要分配的内存大小，而不是用户请求的内存分配大小。</li>
</ul>
</li>
</ul>
<h3 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h3><ul>
<li>如何空间复用?</li>
<li>用户请求分配内存后会实际得到多少内存?</li>
</ul>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><ul>
<li>P为1时,pre chunk size归上一个 chunk使用</li>
<li>size of(chunk in use )&#x3D;(用户请求大小 + 8 -4 ) align to 8B</li>
<li>size of (free)min &#x3D;16B</li>
</ul>
<h2 id="空闲chunk容器"><a href="#空闲chunk容器" class="headerlink" title="空闲chunk容器"></a>空闲chunk容器</h2><h3 id="bins"><a href="#bins" class="headerlink" title="bins"></a>bins</h3><p>用户free掉的内存并不是都会马上归还给系统，ptmalloc会统一管理heap和mmap映射区域中的空闲的chunk，当用户进行下一次分配请求时，ptmalloc会首先试图在空闲的chunk中挑选一块给用户，这样就避免了频繁的系统调用，降低了内存分配的开销。ptmalloc将相似大小的chunk用双向链表链接起来，这样的一个链表被称为一个bin。Ptmalloc一共维护了128个bin，并使用一个数组来存储这些bin<br><img src="data:image/png;base64,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KKCAAgo0VqAWMdKSJUte/OIXH3jggbVlpoW77777TjvtVOdG1lbPhimggAIKKKCAAgooMEECs+rQViKQr371q7Nnz65DY9q2gRZedtllfFXnRrZtuTMVUEABBRRQQAEFFFBgWgK1uI40rRabWAEFFFBAAQUUUEABBRQYnYAx0uhsLVkBBRRQQAEFFFBAAQUmT8AYafLGzBYroIACCiiggAIKKKDA6ASMkUZna8kKKKCAAgoooIACCigweQLGSJM3ZrZYAQUUUEABBRRQQAEFRidQRYz0kY985IgjjnjOc56z+eab77nnnueee273/tx0001HHXUUL9peY401eOP2/Pnz77vvvtYsd95553777Ueya6+9tvVb5kQhn/zkJ4vf8oa6yHXxxRcz/7bbbuN13ttuu23WRbHF9FNOUw6dohm0s5iYNkcDNtxww2WWWYZ/3/jGNy5atKiYxmkFFFBAAQUUUEABBRSom8Bo3/1NSEAEsnDhwuw28Q9BxUknnXTppZe2fY82kcaxxx6b6XnjNn+//e1vTz311JwZExT+6U9/mulvf/vb2223XelbPvItIdBmm232mte8Jr8lRopc1L7bbrsR3tCk+DbqOvPMMy+66KJtttkms3SZIAsR1wMPPECaUncOOOCACMMiO63lj3CRjlNvlzL9SgEFFFBAAQUUUEABBcYoMMIYidiD6zMRP9DDLbfcctasWREvES1wUYVoodhzUhKxRFxBvMEfl3RISZoPfvCD73rXu1ZfffVi+gGnozoaWaqLSrkodOutt05ZHSlpcHSQsOfDH/5wNmnBggXRkXnz5q299trMv/3225lDhIaAMVJCOaGAAgoooIACCiigQN0ERhgjcX9dxA8EIVdddRX/0nniCi4inXbaafFVkYOvIq444YQTjjzyyPiKCzURh5Cr9VJSMft0p+Nq0i677HLFFVeU6qJtvVT3gQ98IAMkLj0tu+yy2QbusmOamXPnzs2ZBFFcR9pggw1yjhMKKKCAAgoooIACCihQN4FRPY9EtMO1FHq70kor3XjjjREg8ZGLM4Q61113HdeF2lqcc845GSCRgEsuhExMEF20TT/gzPe///1ZQtbVS3XcxXf22WeTklylAImZXJ4iZCoGSMxkzuGHH+5FJCj8U0ABBRRQQAEFFFCgtgKjipFOP/306DM3mxEmlfrP0z6toQIh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FFBAAQUUqL2AMVLth8gGKqCAAgoooIACCiigQIUCxkgVYluVAgoooIACCiiggAIK1F7AGKn2Q2QDFVBAAQUUUEABBRRQoEIBY6QKsa1KAQUUUEABBRRQQAEFai9gjFT7IbKBCiiggAIKKKCAAgooUKGAMVKF2FalgAIKKKCAAgoooIACtRcwRqr9ENlABRRQQAEFFFBAAQUUqFDAGKlCbKtSQAEFFFBAAQUUUECB2gsYI9V+iGygAgoooIACCiiggAIKVChgjFQhtlUpoIACCiiggAIKKKBA7QWMkWo/RDZQAQUUUEABBRRQQAEFKhQwRqoQ26oUUEABBRRQQAEFFFCg9gLGSLUfIhuogAIKKKCAAgoooIACFQoYI1WIbVUKKKCAAgoooIACCihQewFjpNoPkQ1UQAEFFFBAAQUUUECBCgWMkSrEtioFFFBAAQUUUEABBRSovYAxUu2HyAYqoIACCiiggAIKKKBAhQLGSBViW5UCCiiggAIKKKCAAgrUXsAYqfZDZAMVUEABBRRQQAEFFFCgQoFZFdZlVQoooEA3gXPPPfe8887rlqKS75YsWUI9l1122U477VRJhY9Xcumlly677LKPf3ZKgRoLHHHEETfddFOVDXz44Yep7s4776x+3TzuuOO22267KjtrXQooMF6BZZYuXTreFli7AgooEAJz58695JJLZrLGz3/+8zXWWGMmC9j3CRJYa621Fi9ePEENHqSpp5122mGHHTZICeZVQIHJEvA60mSNl61VoMkCK620Et3bbLPN5syZM8Z+ch2Js+Orr776BhtsUGUzFi5cePLJJ3McNnv27CrrtS4F+hBgHXnggQdYVVlh+8jeXxauI1177bVca91mm236K6G/XIsWLbr44os33XTTHXfcsb8SzKWAAhMnYIw0cUNmgxVorEDEBhxyzZ8/v7Gd7NwxTlRz8xIHncZInZH8pi4CxEh33303137nzZtXlzaNrB0ESHvuuecOO+xgjDQyYwtWoHYCvrOhdkNigxRQQAEFFFBAAQUUUGCMAsZIY8S3agUUUEABBRRQQAEFFKidgDFS7YbEBimggAIKKKCAAgoooMAYBYyRxohv1QoooIACCiiggAIKKFA7AWOk2g2JDVJAAQUUUEABBRRQQIExChgjjRHfqhVQQAEFFFBAAQUUUKB2AsZItRsSG6SAAgoooIAC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GKlRw2lnFFBAAQUUUEABBRRQYEABY6QBAc2ugAIKKKCAAgoooIACjRIwRmrUcNoZBRRQQAEFFFBAAQUUGFDg/2+/jmkAAGAYhvFnXRD5KgPoMe+KRoqA5gQIECBAgAABAgQIXAlopKt3OoYAAQIECBAgQIAAgSigkSKgOQECBAgQIECAAAECVwIa6eqdjiFAgAABAgQIECBAIApopAhoToAAAQIECBAgQIDAlYBGunqnYwgQIECAAAECBAgQiAIaKQKaEyBAgAABAgQIECBwJaCRrt7pGAIECBAgQIAAAQIEooBGioDmBAgQIECAAAECBAhcCWikq3c6hgABAgQIECBAgACBKKCRIqA5AQIECBAgQIAAAQJXAhrp6p2OIUCAAAECBAgQIEAgCmikCGhOgAABAgQIECBAgMCVgEa6eqdjCBAgQIAAAQIECBCIAhopApoTIECAAAECBAgQIHAloJGu3ukYAgQIECBAgAABAgSigEaKgOYECBAgQIAAAQIECFwJaKSrdzqGAAECBAgQIECAAIEooJEioDkBAgQIECBAgAABAlcCGunqnY4hQIAAAQIECBAgQCAKaKQIaE6AAAECBAgQIECAwJWARrp6p2MIECBAgAABAgQIEIgCGikCmhMgQIAAAQIECBAgcCWgka7e6RgCBAgQIECAAAECBKKARoqA5gQIECBAgAABAgQIXAlopKt3OoYAAQIECBAgQIAAgSigkSKgOQECBAgQIECAAAECVwIa6eqdjiFAgAABAgQIECBAIApopAhoToAAAQIECBAgQIDAlYBGunqnYwgQIECAAAECBAgQiAIaKQKaEyBAgAABAgQIECBwJaCRrt7pGAIECBAgQIAAAQIEooBGioDmBAgQIECAAAECBAhcCWikq3c6hgABAgQIECBAgACBKKCRIqA5AQIECBAgQIAAAQJXAgOi1vYz4oDKwwAAAABJRU5ErkJggg==" srcset="/img/loading.gif" lazyload alt="avatar"></p>
<h4 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h4><ul>
<li>数组中的第一个为unsorted bin，</li>
<li>数组中从2开始编号的前64个bin称为small bins<ul>
<li>同一个small bin中的chunk具有相同的大小。</li>
<li>两个相邻的small bin中的chunk大小相差8bytes。</li>
<li>small bins中的chunk按照最近使用顺序进行排列，最后释放的chunk被链接到链表的头部，而申请chunk是从链表尾部开始，这样，每一个chunk 都有相同的机会被ptmalloc选中。</li>
<li>Small bins后面的bin被称作large bins。large bins中的每一个bin分别包含了一个给定范围内的chunk，其中的chunk按大小序排列。相同大小的chunk同样按照最近使用顺序排列。</li>
<li>ptmalloc使用“smallest-first，best-fit”原则在空闲large bins中查找合适的chunk。</li>
</ul>
</li>
<li>当空闲的chunk被链接到bin中的时候，ptmalloc会把表示该chunk是否处于使用中的标志P设为0（注意，这个标志实际上处在下一个chunk中）同时ptmalloc还会检查它前后的chunk是否也是空闲的，如果是的话，ptmalloc会首先把它们合并为一个大的chunk，然后将合并后的chunk放到unstored bin中。</li>
<li>要注意的是，并不是所有的chunk被释放后就立即被放到bin中。</li>
<li>ptmalloc为了提高分配的速度，会把一些小的的chunk先放到一个叫做fast bins的容器内。</li>
</ul>
<h3 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h3><ul>
<li>程序在运行时会经常需要申请和释放一些较小的内存空间。当分配器合并了相邻的几个小的chunk之后，也许马上就会有另一个小块内存的请求，这样分配器又需要从大的空闲内存中切分出一块，这样无疑是比较低效的，故而，ptmalloc中在分配过程中引入了fast bins，不大于max_fast （默认值为64B）的chunk被释放后，首先会被放到fast bins </li>
<li>fast bins中的chunk并不改变它的使用标志P。这样也就无法将它们合并</li>
<li>当需要给用户分配的chunk小于或等于max_fast时，ptmalloc首先会在fast bins中查找相应的空闲块，然后才会去查找bins中的空闲chunk。</li>
<li>在某个特定的时候，ptmalloc会遍历fast bins中的chunk，将相邻的空闲chunk进行合并，并将合并后的chunk加入unsorted bin中，然后再将usorted bin里的chunk加入bins中。</li>
</ul>
<h3 id="Unsorted-Bin"><a href="#Unsorted-Bin" class="headerlink" title="Unsorted Bin"></a>Unsorted Bin</h3><ul>
<li>unsorted bin的队列使用bins数组的第一个</li>
<li>如果被用户释放的chunk大于max_fast，或者fast bins中的空闲chunk合并后，这些chunk首先会被放到unsorted bin队列中</li>
<li>在进行malloc操作的时候，如果在fast bins中没有找到合适的chunk，则ptmalloc会先在unsorted bin中查找合适的空闲chunk，然后才查找bins。</li>
<li>如果unsorted bin不能满足分配要求。malloc便会将unsorted bin中的chunk加入bins中。然后再从bins中继续进行查找和分配过程。</li>
<li>unsorted bin可以看做是bins的一个缓冲区，增加它只是为了加快分配的速度。</li>
</ul>
<blockquote>
<p>并不是所有的chunk都按照上面的方式来组织，实际上，有三种例外情况。Top chunk，mmaped chunk和last remainder</p>
</blockquote>
<h3 id="Top-chunk"><a href="#Top-chunk" class="headerlink" title="Top chunk"></a>Top chunk</h3><blockquote>
<p> top chunk对于主分配区和非主分配区是不一样的。</p>
</blockquote>
<ul>
<li>非主分配区<ul>
<li>对于非主分配区会预先从mmap区域分配一块较大的空闲内存模拟sub-heap，通过管理sub-heap来响应用户的需求</li>
<li>因为内存是按地址从低向高进行分配的，在空闲内存的最高处，必然存在着一块空闲chunk，叫做top chunk。</li>
<li>当bins和fast bins都不能满足分配需要的时候，ptmalloc会设法在top chunk中分出一块内存给用户 .如果top chunk本身不够大，分配程序会重新分配一个sub-heap，并将top chunk迁移到新的sub-heap上，新的sub-heap与已有的sub-heap用单向链表连接起来，然后在新的top chunk上分配所需的内存以满足分配的需要</li>
<li>实际上，top chunk在分配时总是在fast bins和bins之后被考虑，所以，不论top chunk有多大，它都不会被放到fast bins或者是bins中。</li>
<li>Top chunk的大小是随着分配和回收不停变换的，如果从top chunk分配内存会导致top chunk减小，如果回收的chunk恰好与top chunk相邻，那么这两个chunk就会合并成新的top chunk，从而使top chunk变大。</li>
<li>如果在free时回收的内存大于某个阈值，并且top chunk的大小也超过了收缩阈值，ptmalloc会收缩sub-heap，如果top-chunk包含了整个sub-heap，ptmalloc会调用munmap把整个sub-heap的内存返回给操作系统。</li>
</ul>
</li>
<li>主分配区<ul>
<li>由于主分配区是唯一能够映射进程heap区域的分配区，它可以通过sbrk()来增大或是收缩进程heap的大小</li>
<li>ptmalloc在开始时会预先分配一块较大的空闲内存（也就是所谓的 heap），主分配区的top chunk在第一次调用malloc时会分配一块(chunk_size + 128KB) align 4KB大小的空间作为初始的heap</li>
<li>用户从top chunk分配内存时，可以直接取出一块内存给用户。在回收内存时，回收的内存恰好与top chunk相邻则合并成新的top chunk，当该次回收的空闲内存大小达到某个阈值，并且top chunk的大小也超过了收缩阈值，会执行内存收缩，减小top chunk的大小，但至少要保留一个页大小的空闲内存，从而把内存归还给操作系统。</li>
<li>如果向主分配区的top chunk申请内存，而top chunk中没有空闲内存，ptmalloc会调用sbrk()将的进程heap的边界brk上移，然后修改top chunk的大小。</li>
</ul>
</li>
</ul>
<h3 id="mmaped-chunk"><a href="#mmaped-chunk" class="headerlink" title="mmaped chunk"></a>mmaped chunk</h3><blockquote>
<p>当需要分配的chunk足够大，而且fast bins和bins都不能满足要求，甚至top chunk本身也不能满足分配需求时，ptmalloc会使用mmap来直接使用内存映射来将页映射到进程空间。</p>
</blockquote>
<p>chunk在被free时将直接解除映射，于是就将内存归还给了操作系统，再次对这样的内存区的引用将导致segmentation fault错误。这样的chunk也不会包含在任何bin中</p>
<h3 id="Last-remainder"><a href="#Last-remainder" class="headerlink" title="Last remainder"></a>Last remainder</h3><ul>
<li>Last remainder是另外一种特殊的chunk，就像top chunk和mmaped chunk一样，不会在任何bins中找到这种chunk。</li>
<li>当需要分配一个small chunk，但在small bins中找不到合适的chunk，如果last remainder chunk的大小大于所需的small chunk大小，last remainder chunk被分裂成两个chunk，其中一个chunk返回给用户，另一个chunk变成新的last remainder chuk</li>
</ul>
<h3 id="问题-3"><a href="#问题-3" class="headerlink" title="问题"></a>问题</h3><ul>
<li>bins是以何种结构存在的?</li>
<li>都有哪些bins?各自的特点如何?</li>
<li>有哪三种不同的bins?各自在什么地方使用?</li>
<li>top chunk的主分配区和非主分配区在使用时有什么不一样?</li>
</ul>
<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>bin</p>
<ul>
<li>用户free掉的内存不都还给系统,ptmalloc会将相似大小的chunk用双向链表连起来,这就是Bin</li>
<li>一共维护有128个bin,第一个为unsorted bins</li>
<li>2-64为small bins</li>
<li>两相邻大小bins相差8bytes(small bins)</li>
<li>除了FAST BINS 都使用 FIFO原则</li>
<li>64-128为large bins ,每一个大小都在一定范围内,按大小排序,一样大的类似small bins使用</li>
<li>空闲的chunk连入bin时,会将 P 设为 0 , 并检查前后chunk是否空闲,若空闲则合并后加入unsorted bins中</li>
</ul>
</li>
<li><p>fast bins</p>
<ul>
<li>size &lt; max_fast的chunk被free后先放入fastbins中,且不改变P</li>
<li>用户所要Chunk &lt; max_fast 时先便利fast bin</li>
<li>有时会便利fast bin,将相邻的chunk合并后放入unsorted bin中,然后将unsorted中的chunk 加入bin中</li>
</ul>
</li>
<li><p>unsorted bins</p>
<ul>
<li>使用bins数组的第一个,若free的chunk&gt;max_fast,或fast bins 合并后,先放入unsorted bin中</li>
<li>malloc时若fastbin中没有合适的,就现在unsorted中找,最后才是bins</li>
<li>若unsorted也不能满足分配,malloc会将其内的chunk放入bins中再分配</li>
<li>可以看作时bins的缓冲区,用来加快分配速度</li>
</ul>
</li>
<li><p>top chunk</p>
<ul>
<li>主分配区和非主分配区不一样</li>
<li>N_MA<ul>
<li>预先从mmap中分配一块较大的空闲内存模拟sub-heap(内存从低到高分配)</li>
<li>内存最高处必有空闲chunk为Top chunk</li>
<li>bins和fast bins都没有满足的时,会在TOP中分配</li>
<li>永远不会放入fastbins和bins中</li>
<li>若回收的chunk和top相连,会将它们合并,若大小大于某只且top大于收缩阈值,将收缩sub-heap,返回给系统</li>
</ul>
</li>
<li>MA<ul>
<li>先预先分配空闲内存(sub-heap)</li>
<li>MA的top首先malloc时会分配(chunk+128KB)align 4KB的空间为初始HEAP</li>
<li>回收大于阈值,top也大于阈值,则内存收缩.减少TOP但至少保留一页大小,剩下的归还给系统</li>
<li>申请内存时,top无空闲,将会用sbrk上移heap边界</li>
<li>若本身不够大,则重新分配sub-heap,并将top迁移到新的sub-heap上,以链表连接,重新分配</li>
</ul>
</li>
</ul>
</li>
<li><p>mmap chunk</p>
<ul>
<li>若分配内存太大,且fast和bins中都不能满足时,甚至连TOP也不够时,用mmap直接映射页到进程空间</li>
<li>分配的chunk被free时直接解除映射,还给系统</li>
</ul>
</li>
<li><p>last remainder</p>
<ul>
<li>需要分配small bins,但small中无合适的chunk时,若last大小大于所需的small chunk,将会分裂成两个chunk,一个给用户,一个变成新的last</li>
</ul>
</li>
</ul>
<h2 id="sbrk和mmap"><a href="#sbrk和mmap" class="headerlink" title="sbrk和mmap"></a>sbrk和mmap</h2><h3 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h3><ul>
<li>从进程的内存布局可知，.bss 段之上的这块分配给用户程序的空间被称为 heap （堆）。</li>
<li>start_brk 指向 heap 的开始，而 brk 指向 heap 的顶部。</li>
<li>可以使用系统调用 brk()和 sbrk()来增 加标识 heap 顶部的 brk 值，从而线性的增加分配给用户的 heap 空间。</li>
<li>在使用malloc 之前， brk的值等于start_brk，也就是说heap大小为0。</li>
<li>ptmalloc在开始时，若请求的空间小于 mmap 分配阈值（mmap threshold，默认值为 128KB）时<ul>
<li>主分配区会调用 sbrk()增加一块大小为 (128 KB + chunk_size) align 4KB 的空间作为 heap。</li>
<li>非主分配区会调用 mmap 映射一块大小为 HEAP_MAX_SIZE（32 位系统上默认为1MB，64 位系统上默认为64MB）的空间作为 sub-heap。 这就是前面所说的 ptmalloc 所维护的分配空间，</li>
<li>当用户请求内存分配时，首先会在这个区域内找一块合适的 chunk 给用户。</li>
</ul>
</li>
<li>当用户释放了 heap 中的 chunk 时，ptmalloc 又会使用 fast bins 和 bins 来组织空闲 chunk。以备用户的下一次分配。</li>
<li>若需要分配的 chunk 大小小于mmap 分配阈值，而 heap 空间又不够<ul>
<li>此时主分配区会通过 sbrk()调用来增加 heap 大小</li>
<li>非主分配区会调用mmap 映射一块新的 sub-heap，也就是增加 top chunk 的大小，每次 heap 增 加的值都会对齐到 4KB。 </li>
<li>当用户的请求超过mmap 分配阈值，并且主分配区使用 sbrk()分配失败的时候，或是非主分配区在 top chunk 中不能分配到需要的内存时，ptmalloc 会尝试使用mmap()直接映射一块内存到进程内存空间。使用 mmap()直接映射的 chunk 在释放时直接解除映射，而不再属于进程的内存空间。任何对该内存的访问都会产生段错误。而在 heap 中或是 sub-heap中分配的空间则可能会留在进程内存空间内，还可以再次引用（当然是很危险的）。</li>
</ul>
</li>
<li>当 ptmalloc munmap chunk 时，如果回收的 chunk 空间大小大于mmap 分配阈值的当前值，并且小于 DEFAULT_MMAP_THRESHOLD_MAX（32 位系统默认为 512KB，64 位系统默认 为 32MB），ptmalloc 会把 mmap 分配阈值调整为当前回收的 chunk 的大小，并将 mmap 收 缩阈值（mmap trim threshold）设置为mmap 分配阈值的 2 倍。这就是 ptmalloc 的对mmap 分配阈值的动态调整机制，该机制是默认开启的，当然也可以用mallopt()关闭该机制。</li>
</ul>
<h3 id="问题-4"><a href="#问题-4" class="headerlink" title="问题"></a>问题</h3><ul>
<li>有什么不同的机制?</li>
<li>sbrk和mmap的区别是?</li>
</ul>
<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><ul>
<li>ptmalloc开始时,若小于mmap的分配阈值(128KB)<ul>
<li>则主分配区用sbrk增加一块大小为(128KB+chunk_size) align 4KB的内存作为heap</li>
<li>非主分配区会使用mmap映射一块大小为HEAP_SIZE(32-1MB,64-64MB)的空间为sub-heap</li>
<li>请求分配时,现在期内寻找相应的chunk</li>
<li>用户free chunk后会放入fast bins中</li>
</ul>
</li>
<li>若chunk &lt; mmap的分配阈值,但heap空间不足时<ul>
<li>主分配区会使用sbrk来增加大小</li>
<li>非主会用mmap映射新的sub-heap(对齐到4KB)</li>
</ul>
</li>
<li>若chunk &gt;mmap的分配阈值,但主分配区sbrk失败,非主分配区top chunk不足,就会用mmap映射内存</li>
<li>ptmalloc munmap chunk时 ,DEFAULT_MMAP_THRESHOLD_MAX(32 - 512kb , 64 - 32MB) &gt; 回收的chunk &gt; mmap分配阈值时<ol>
<li>将把mmap分配阈值调整为当前回收的chunk大小</li>
<li>将mmap收缩阈值设置为mmap分配阈值的2倍</li>
</ol>
</li>
</ul>
<h2 id="内存分配概述"><a href="#内存分配概述" class="headerlink" title="内存分配概述"></a>内存分配概述</h2><blockquote>
<p>分配算法概述，以 32 系统为例，64 位系统类似。 </p>
</blockquote>
<h3 id="内容-2"><a href="#内容-2" class="headerlink" title="内容"></a>内容</h3><ul>
<li>小于等于 64 字节：用 pool 算法分配。</li>
<li>64 到 512 字节之间：在最佳匹配算法分配和 pool 算法分配中取一种合适的。</li>
<li>大于等于 512 字节：用最佳匹配算法分配。 </li>
<li>大于等于mmap 分配阈值（默认值 128KB）：根据设置的 mmap 的分配策略进行分配<ul>
<li>如果没有开启mmap分配阈值的动态调整机制，大于等于 128KB 就直接调用mmap分配。</li>
<li>否则，大于等于mmap分配阈值时才直接调用mmap()分配。</li>
</ul>
</li>
</ul>
<h3 id="分配的具体步骤"><a href="#分配的具体步骤" class="headerlink" title="分配的具体步骤"></a>分配的具体步骤</h3><ol>
<li>获取分配区的锁，为了防止多个线程同时访问同一个分配区，在进行分配之前需要 取得分配区域的锁。线程先查看线程私有实例中是否已经存在一个分配区，如果存 在尝试对该分配区加锁，如果加锁成功，使用该分配区分配内存，否则，该线程搜 索分配区循环链表试图获得一个空闲（没有加锁）的分配区。如果所有的分配区都 已经加锁，那么 ptmalloc 会开辟一个新的分配区，把该分配区加入到全局分配区循 环链表和线程的私有实例中并加锁，然后使用该分配区进行分配操作。开辟出来的 新分配区一定为非主分配区，因为主分配区是从父进程那里继承来的。开辟非主分 配区时会调用mmap()创建一个 sub-heap，并设置好 top chunk。</li>
<li>将用户的请求大小转换为实际需要分配的 chunk 空间大小。 </li>
<li>判断所需分配chunk的大小是否满足chunk_size &lt;&#x3D; max_fast (max_fast 默认为 64B)， 如果是的话，则转下一步，否则跳到第 5 步。</li>
<li>首先尝试在 fast bins 中取一个所需大小的 chunk 分配给用户。如果可以找到，则分 配结束。否则转到下一步。</li>
<li>判断所需大小是否处在 small bins 中，即判断 chunk_size &lt; 512B 是否成立。如果 chunk 大小处在 small bins 中，则转下一步，否则转到第 6 步。</li>
<li>根据所需分配的 chunk 的大小，找到具体所在的某个 small bin，从该 bin 的尾部摘 取一个恰好满足大小的 chunk。若成功，则分配结束，否则，转到下一步。</li>
<li>到了这一步，说明需要分配的是一块大的内存，或者 small bins 中找不到合适的 chunk。于是，ptmalloc 首先会遍历 fast bins 中的 chunk，将相邻的 chunk 进行合并， 并链接到 unsorted bin 中，然后遍历 unsorted bin 中的 chunk，如果 unsorted bin 只 有一个 chunk，并且这个 chunk 在上次分配时被使用过，并且所需分配的 chunk 大 小属于 small bins，并且 chunk 的大小大于等于需要分配的大小，这种情况下就直 接将该 chunk 进行切割，分配结束，否则将根据 chunk 的空间大小将其放入 small bins 或是 large bins 中，遍历完成后，转入下一步。</li>
<li>到了这一步，说明需要分配的是一块大的内存，或者 small bins 和 unsorted bin 中 都找不到合适的 chunk，并且 fast bins 和 unsorted bin 中所有的 chunk 都清除干净 了。从 large bins 中按照“smallest-first，best-fit”原则，找一个合适的 chunk，从 中划分一块所需大小的 chunk，并将剩下的部分链接回到 bins 中。若操作成功，则 分配结束，否则转到下一步。</li>
<li>如果搜索 fast bins 和 bins 都没有找到合适的 chunk，那么就需要操作 top chunk 来 进行分配了。判断 top chunk 大小是否满足所需 chunk 的大小，如果是，则从 top chunk 中分出一块来。否则转到下一步。</li>
<li>到了这一步，说明 top chunk 也不能满足分配要求，所以，于是就有了两个选择: 如 果是主分配区，调用 sbrk()，增加 top chunk 大小；如果是非主分配区，调用mmap 来分配一个新的 sub-heap，增加 top chunk 大小；或者使用mmap()来直接分配。在 这里，需要依靠 chunk 的大小来决定到底使用哪种方法。判断所需分配的 chunk 大小是否大于等于 mmap 分配阈值，如果是的话，则转下一步，调用mmap 分配， 否则跳到第 12 步，增加 top chunk 的大小。</li>
<li>使用mmap 系统调用为程序的内存空间映射一块 chunk_size align 4kB 大小的空间。 然后将内存指针返回给用户。</li>
<li>判断是否为第一次调用malloc，若是主分配区，则需要进行一次初始化工作，分配一块大小为(chunk_size + 128KB) align 4KB 大小的空间作为初始的 heap。若已经初 始化过了，主分配区则调用 sbrk()增加 heap 空间，分主分配区则在 top chunk 中切 割出一个 chunk，使之满足分配需求，并将内存指针返回给用户。</li>
</ol>
<h3 id="问题-5"><a href="#问题-5" class="headerlink" title="问题"></a>问题</h3><ul>
<li>用了什么算法?</li>
<li>分配的步骤大概为?</li>
</ul>
<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>这里用了华庭师傅的总结</p>
</blockquote>
<ul>
<li>根据用户请求分配的内存的大小，ptmalloc 有可能会在两个地方为用户分配内存空间。</li>
<li>在第一次分配内存时，一般情况下只存在一个主分配区，但也有可能从父进程那里继承来了多个非主分配区，在这里主要讨论主分配区的情况.</li>
<li>开始时brk 值等于 start_brk，所以实际上 heap 大小为 0，top chunk 大小也是 0。这时，如果不增加 heap 大小，就不能满足任何分配要求。</li>
<li>若用户的请求的内存大小小于mmap 分配阈值， 则 ptmalloc 会初始 heap。然后在 heap 中分配空间给用户，以后的分配就基于这个 heap 进行。</li>
<li>若第一次用户的请求就大于 mmap 分配阈值，则 ptmalloc 直接使用 mmap()分配 一块内存给用户，而 heap 也就没有被初始化，直到用户第一次请求小于 mmap 分配阈 值的内存分配。</li>
<li>第一次以后的分配就比较复杂了<ul>
<li>简单说来，ptmalloc首先会查找fast bins</li>
<li>如果不能找到匹配的 chunk，则查找 small bins。</li>
<li>若还是不行，合并 fast bins，把 chunk 加入 unsorted bin，在 unsorted bin 中查找</li>
<li>若还是不行，把 unsorted bin 中的 chunk 全 加入 large bins 中，并查找 large bins。</li>
<li>在 fast bins 和 small bins 中的查找都需要精确匹配， 而在 large bins 中查找时，则遵循“smallest-first，best-fit”的原则，不需要精确匹配。</li>
<li>若以上方法都失败了，则 ptmalloc 会考虑使用 top chunk。</li>
<li>若 top chunk 也不能满足分配 要求。而且所需 chunk 大小大于 mmap 分配阈值，则使用 mmap 进行分配。否则增加 heap，增大 top chunk。以满足分配要求</li>
</ul>
</li>
</ul>
<h2 id="内存回收概述"><a href="#内存回收概述" class="headerlink" title="内存回收概述"></a>内存回收概述</h2><blockquote>
<p>free() 函数接受一个指向分配区域的指针作为参数，释放该指针所指向的 chunk。而具体的释放方法则看该 chunk 所处的位置和该 chunk 的大小</p>
</blockquote>
<h3 id="工作步骤"><a href="#工作步骤" class="headerlink" title="工作步骤"></a>工作步骤</h3><ol>
<li>free()函数同样首先需要获取分配区的锁，来保证线程安全。</li>
<li>判断传入的指针是否为 0，如果为 0，则什么都不做，直接 return。否则转下一步。 </li>
<li>判断所需释放的 chunk 是否为 mmaped chunk，如果是，则调用 munmap()释放 mmaped chunk，解除内存空间映射，该该空间不再有效。如果开启了mmap 分配 阈值的动态调整机制，并且当前回收的 chunk 大小大于mmap 分配阈值，将mmap 分配阈值设置为该 chunk 的大小，将 mmap 收缩阈值设定为 mmap 分配阈值的 2 倍，释放完成，否则跳到下一步。</li>
<li>判断 chunk 的大小和所处的位置，若 chunk_size &lt;&#x3D; max_fast，并且 chunk 并不位于 heap 的顶部，也就是说并不与 top chunk 相邻，则转到下一步，否则跳到第 6 步。 （因为与 top chunk 相邻的小 chunk 也和 top chunk 进行合并，所以这里不仅需要 判断大小，还需要判断相邻情况）</li>
<li>将 chunk 放到 fast bins 中，chunk 放入到 fast bins 中时，并不修改该 chunk 使用状 态位 P。也不与相邻的 chunk 进行合并。只是放进去，如此而已。这一步做完之后 释放便结束了，程序从 free()函数中返回。</li>
<li>判断前一个 chunk 是否处在使用中，如果前一个块也是空闲块，则合并。并转下一 步。</li>
<li>判断当前释放 chunk 的下一个块是否为 top chunk，如果是，则转第 9 步，否则转 下一步。</li>
<li>判断下一个 chunk 是否处在使用中，如果下一个 chunk 也是空闲的，则合并，并将合并后的 chunk 放到 unsorted bin 中。注意，这里在合并的过程中，要更新 chunk 的大小，以反映合并后的 chunk 的大小。并转到第 10 步。</li>
<li>如果执行到这一步，说明释放了一个与 top chunk 相邻的 chunk。则无论它有多大， 都将它与 top chunk 合并，并更新 top chunk 的大小等信息。转下一步。</li>
<li>判断合并后的 chunk 的大小是否大于 FASTBIN_CONSOLIDATION_THRESHOLD（默认 64KB），如果是的话，则会触发进行 fast bins 的合并操作，fast bins 中的 chunk 将被 遍历，并与相邻的空闲 chunk 进行合并，合并后的 chunk 会被放到 unsorted bin 中。 fast bins 将变为空，操作完成之后转下一步。</li>
<li>判断 top chunk 的大小是否大于mmap 收缩阈值（默认为 128KB），如果是的话，对 于主分配区，则会试图归还 top chunk 中的一部分给操作系统。但是最先分配的 128KB 空间是不会归还的，ptmalloc 会一直管理这部分内存，用于响应用户的分配 请求；如果为非主分配区，会进行 sub-heap 收缩，将 top chunk 的一部分返回给操作系统，如果 top chunk 为整个 sub-heap，会把整个 sub-heap 还回给操作系统。做 完这一步之后，释放结束，从 free() 函数退出。可以看出，收缩堆的条件是当前 free 的 chunk 大小加上前后能合并 chunk 的大小大于 64k，并且要 top chunk 的大 小要达到mmap 收缩阈值，才有可能收缩堆。</li>
</ol>
<h3 id="问题-6"><a href="#问题-6" class="headerlink" title="问题"></a>问题</h3><ul>
<li>概述一下大概过程?</li>
<li>有什么特点?</li>
</ul>
<h3 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h3><ol>
<li>先获取锁,然后判断指针是否为0,为0就直接return</li>
<li>否则判断是否时mmap分配的,是就直接删除映射,进行动态阈值调整</li>
<li>否则就判断chunk的大小和位置,如果 chunk &lt; max_fast 并且不位于heap顶部,就放入fast bins中</li>
<li>否则判断前一个chunk是否在使用中,如果前一个也是空闲块就合并然后放入unsorted bins中</li>
<li>判断是否大于FASTBIM_CONNSOLIDATION_THRESHOLD,若大于就合并fast bins然后放入unsorted中,此时Fast bins变为空</li>
<li>判断top chunk大小是否大于mmap收缩阈值,若是<ul>
<li>主分配区就归还top chunk的一部分给系统,开始的128KB不会归还</li>
<li>非主分配区会进行sub-heap的收缩,将其中一部分归还给操作系统,若top chunk为整个sub-heap就全部归还</li>
<li>如果chunk与top chunk相邻也要如此操作</li>
</ul>
</li>
</ol>
<p>关于源代码的相关分析部分这里就不记了,读完华庭师傅的文章收益良多,可能得多读几遍才能领会其中奥秘</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>glic内存管理学习笔记</div>
      <div>https://nightrainy.github.io/2019/05/06/glic内存管理学习笔记/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>知世</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年5月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="ND - 禁止演绎">
                    <i class="iconfont icon-cc-nd"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/07/11/tcache%E6%9C%BA%E5%88%B6%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0/" title="tcache.md">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">tcache.md</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/03/09/pwn-learning-FUZZ/" title="pwn_learning&amp;&amp;FUZZ">
                        <span class="hidden-mobile">pwn_learning&amp;&amp;FUZZ</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
